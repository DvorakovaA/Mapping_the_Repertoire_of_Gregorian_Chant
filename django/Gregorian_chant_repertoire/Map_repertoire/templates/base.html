<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8" />
        {% load static %}
        <link rel="stylesheet" href="{% static 'leaflet/leaflet.css' %}" />
        <script src="{% static 'leaflet/leaflet.js' %}"></script>
        <script src="{% static 'leaflet-svg-shape-markers.js' %}"></script>
        <script src="{% static 'create_map.js' %}"></script>

        <style>
            .tabcontent {
            display: none;
            } 

            .child {
                float: left;
                padding: 10px;
            }

            table, td, th {
                border: 1px solid black;
            }

            table {
                border-collapse: collapse;
                padding: auto;
                white-space: nowrap;
            }

            td {
                vertical-align: top;
            }
            
            th {
                text-align: left;
            }

            .mainTable {
                border-collapse: collapse;
            }

            .collapsible {
                display: grid;
                grid-template-rows: 1fr;
                opacity: 1;
                transition: grid-template-rows 0.3s ease-out, opacity 0.3s ease-out;
            }

            .collapsible.collapsed {
                grid-template-rows: 0fr;
                opacity: 0;
            }

            .collapsible-inner {
                overflow: hidden;
            }

            button.toggle-table {
                background-color: rgb(199, 202, 199);
            }

            #com_map {
                height: calc(80vh - 80px);
                width: calc(90vw - 80px);
            }

            #cen_map {
                height: calc(80vh - 80px);
                width: calc(90vw - 80px);
            }

            h3, .h3 {
                margin-bottom: 0;
            }

            h4, .h4 {
                margin-top: 0;
            }

            li {
                display: inline;
            }

            #numberOfTopicsSelection {
                display: none;
            }

        </style>

        <title>{% block title %} Map_repertoire {% endblock %}</title>
    </head>

    <body>
        <div id="right_top_corner" style="float:right" class="container">

            <div id="help" class="child">
                <button onclick="location.href = '/map_repertoire/help'">Help</button>
             </div>
        </div>


        {% block header %}  {% endblock %}

        <div id="side_buttons" style="float: right;">
            {% block side_buttons %}

            {% endblock %}
        </div>

        <div id="history">
            {% block history %}

            {% endblock %}
        </div>

        <div id="content">
            {% block content %}

            {% endblock %}
        </div>

        

        <div id ="result">
            {% block result %}

            {% endblock %}

            
        </div>

        <div id="all_map">
        {% block map %}

        {% endblock %}
        </div>
    </body>

    <script>
        function openView(evt, viewName) {
          let i, tabcontent, tablinks;
          //clear previous
          tabcontent = document.getElementsByClassName("tabcontent");
          for (i = 0; i < tabcontent.length; i++) {
            tabcontent[i].style.display = "none";
          }
          //set new
          tablinks = document.getElementsByClassName("tablinks");
          for (i = 0; i < tablinks.length; i++) {
            tablinks[i].className = tablinks[i].className.replace(" active", "");
          }
          document.getElementById(viewName).style.display = "block";
          evt.currentTarget.className += " active";
        }


        // Toggle parts of table view

        document.addEventListener('DOMContentLoaded', function () {
            var mainTable = document.getElementsByClassName('mainTable')[0];
            
            // Get all elements with data-collapsible-trigger attribute
            var triggerElements = mainTable.querySelectorAll('[data-collapsible-trigger]');

            // Iterate through each trigger element
            triggerElements.forEach(function (trigger) {
                // Add click event listener to each trigger
                trigger.addEventListener('click', function () {
                    // Find the closest parent with data-collapsible-container attribute
                    var container = this.closest('[data-collapsible-container]');

                    // Find the collapsible element within the container
                    var collapsible = container.querySelector('[data-collapsible]');

                    // Toggle the collapsed class on the collapsible element
                    collapsible.classList.toggle('collapsed');

                    // Toggle the text content of the trigger
                    var triggerText = collapsible.classList.contains('collapsed') ? 'Show more' : 'Hide';
                    this.textContent = triggerText;
                });
            });
        
            var expandAllTrigger = document.querySelectorAll('[data-collapsible-expand-all]');
            expandAllTrigger.forEach(function (trigger) {
                trigger.addEventListener('click', function () {
                var collabsibleContainers = mainTable.querySelectorAll('[data-collapsible-container]');
                collabsibleContainers.forEach(function (container) {
                    var collapsibleElements = container.querySelectorAll('[data-collapsible]');
                    collapsibleElements.forEach(function (collapsibleEl) {
                    collapsibleEl.classList.remove('collapsed');
                    });
                    var collapsibleTriggers = container.querySelectorAll('[data-collapsible-trigger]');
                    collapsibleTriggers.forEach(function (triggerEl) {
                    triggerEl.textContent = 'Hide';
                    });
                });
                });
            });
        
            var collapseAllTrigger = document.querySelectorAll('[data-collapsible-collapse-all]');
            collapseAllTrigger.forEach(function (trigger) {
                trigger.addEventListener('click', function () {
                var collabsibleContainers = mainTable.querySelectorAll('[data-collapsible-container]');
                collabsibleContainers.forEach(function (container) {
                    var collapsibleElements = container.querySelectorAll('[data-collapsible]');
                    collapsibleElements.forEach(function (collapsibleEl) {
                    collapsibleEl.classList.add('collapsed');
                    });
                    var collapsibleTriggers = container.querySelectorAll('[data-collapsible-trigger]');
                    collapsibleTriggers.forEach(function (triggerEl) {
                    triggerEl.textContent = 'Show more';
                    });
                });
                });
            });
        });
    
        
        // Dynamic changes in displaying form
        // Louvein      
        var Louvein_checked = document.getElementById('id_community_detection_algorithm_0');
        Louvein_checked.addEventListener('click', function() {
                document.getElementById('metricSelection').style.display = 'inline';
                document.getElementById('numberOfTopicsSelection').style.display = 'none';
        })
        // Topic model
        var Topic_checked = document.getElementById('id_community_detection_algorithm_1');
        Topic_checked.addEventListener('click', function() { 
            document.getElementById('metricSelection').style.display = 'none';
            document.getElementById('numberOfTopicsSelection').style.display = 'inline';
        });
        // to preserve choices after Show (refresh)
        if (document.getElementById('id_community_detection_algorithm_1').checked) {
            document.getElementById('metricSelection').style.display = 'none';
            document.getElementById('numberOfTopicsSelection').style.display = 'inline'
        }
        
    </script>
        
</html>